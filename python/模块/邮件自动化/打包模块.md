```
# -*- coding: utf-8 -*-
# 自动发送邮件
"""
在Python发送邮件主要借助到smtplib和email这个两个模块。
smtplib：主要用来建立和断开与服务器连接的工作。
email：主要用来设置一些些与邮件本身相关的内容。
"""

import os

import smtplib
from email.mime.application import MIMEApplication  # 主要类型的MIME消息对象应用
from email.mime.multipart import MIMEMultipart  # 带多个部分的邮件
from email.mime.text import MIMEText  # html格式和文本格式邮件


# 文本邮件
def plan_mail(text):
    return MIMEText(text, 'plain', 'utf-8')  # 邮件内容


# Html邮件,'<a href="http://www.baidu.com" target="_blank">点一下去百度</a>'
def html_mail(html):
    return MIMEText(html, 'html', 'utf-8')  # 邮件内容


# 附件:word、excel、pdf
def file_mail(file):
    with open(file, 'rb') as fp:
        attachfiles = MIMEApplication(fp.read())
        attachfiles.add_header('Content-Disposition', 'attachment', filename=f"{os.path.basename(file)}")
    return attachfiles

def email(to_addr, msg_list, cc_addr=None,bcc_addr=None, subject=None, **mail):
    """
    自动发送邮件
    :param to_addr: 收件人列表,最多30个
    :param msg_list: 邮件内容
    :param cc_addr: 抄送人列表
    :param bcc_addr: 密送人列表
    :param subject: 邮件主题
    :param mail: 邮箱服务器登录字典
    :return: 发送情况
    """
    # 创建一个多部分的邮件对象
    message = MIMEMultipart('mixed')  # mixed alternative
    for msg in msg_list:
        message.attach(msg)
    if len(to_addr) == 0:
        print("收件人地址为空，注意核查！！")
        return
    receivers = to_addr
    if cc_addr:
        message['Cc'] = ",".join(cc_addr)
        receivers = receivers + cc_addr
    if bcc_addr:
        receivers = receivers + bcc_addr
    message['from'] = mail["mail_user"]
    message['To'] = ",".join(to_addr)
    message['Subject'] = subject
    try:
        smtpObj = smtplib.SMTP()
        smtpObj.connect(mail["mail_host"], mail["mail_prot"])  # 发件人邮箱中的SMTP服务器及端口
        smtpObj.login(mail["mail_user"], mail["mail_pass"])
        smtpObj.sendmail(mail["mail_user"], receivers, message.as_string())
        smtpObj.quit()
        print("邮件发送成功")
    except smtplib.SMTPConnectError as e:
        print('邮件发送失败，连接失败:', e.smtp_code, e.smtp_error)
    except smtplib.SMTPAuthenticationError as e:
        print('邮件发送失败，认证错误:', e.smtp_code, e.smtp_error)
    except smtplib.SMTPSenderRefused as e:
        print('邮件发送失败，发件人被拒绝:', e.smtp_code, e.smtp_error)
    except smtplib.SMTPRecipientsRefused as e:
        print('邮件发送失败，收件人被拒绝:', e.smtp_code, e.smtp_error)
    except smtplib.SMTPDataError as e:
        print('邮件发送失败，数据接收拒绝:', e.smtp_code, e.smtp_error)
    except smtplib.SMTPException as e:
        print('邮件发送失败, ', e.message)
    except Exception as e:
        print('邮件发送异常, ', str(e))

if __name__ == '__main__':
    # 第三方 SMTP 服务
    mail = {
        "mail_host": "smtp.126.com",  # 设置服务器
        "mail_prot": 25,  # 服务器端口
        "mail_user": "13253931266@126.com",  # 用户名
        "mail_pass": "DJDUATAINNCBBUUH"  # 授权码
    }

    to_addr = ['978345836@qq.com', ]  # 接收邮件，可设置为你的QQ邮箱或者其他邮箱
    cc_addr = ["13253931266@126.com"]  # 抄送人
    subject = 'Python SMTP 邮件测试'  # 邮件主题
    path = "D:/桌面"
    file_list = [path + "/1.docx", path + "/工作日报.xlsx", path + "/load_log"]
    msg_list = []
    for file in file_list:
        message = file_mail(file)
        msg_list.append(message)

    t="qwqweewqwe"

    # 签名
    html_sign ="""
        <br>
        <hr style="width: 210px; height: 1px;" size="1" color="#b5c4df" align="left">
         <p></p><p></p>**********************************************
         <p></p><b>中兴通讯河南电信省公司高端优化项目组</b>
         <p></p><b>姓        名：张晓强
         <p></p><b>手        机：13253931266</b>
         <p></p><b>邮        箱：13253931266@126.com</b>
         <p></p>**********************************************
    """
    msg_list.append(html_mail(t+html_sign))
    email(to_addr=to_addr,cc_addr=cc_addr,msg_list=msg_list, subject=subject, **mail)

```

